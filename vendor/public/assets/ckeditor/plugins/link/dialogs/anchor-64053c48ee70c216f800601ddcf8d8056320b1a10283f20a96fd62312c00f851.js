CKEDITOR.dialog.add("anchor",function(i){function n(e,t){return e.createFakeElement(e.document.createElement("a",{attributes:t}),"cke_anchor","anchor")}return{title:i.lang.link.anchor.title,minWidth:300,minHeight:60,onOk:function(){var e=CKEDITOR.tools.trim(this.getValueOf("info","txtName")),t={id:e,name:e,"data-cke-saved-name":e};this._.selectedElement?this._.selectedElement.data("cke-realelement")?((e=n(i,t)).replace(this._.selectedElement),CKEDITOR.env.ie&&i.getSelection().selectElement(e)):this._.selectedElement.setAttributes(t):(e=(e=i.getSelection())&&e.getRanges()[0]).collapsed?(t=n(i,t),e.insertNode(t)):(CKEDITOR.env.ie&&CKEDITOR.env.version<9&&(t["class"]="cke_anchor"),(t=new CKEDITOR.style({element:"a",attributes:t})).type=CKEDITOR.STYLE_INLINE,t.applyToRange(e))},onHide:function(){delete this._.selectedElement},onShow:function(){var e,t=i.getSelection();e=t.getRanges()[0];var n=t.getSelectedElement();e.shrink(CKEDITOR.SHRINK_ELEMENT),e=(n=e.getEnclosedNode())&&n.type===CKEDITOR.NODE_ELEMENT&&("anchor"===n.data("cke-real-element-type")||n.is("a"))?n:void 0;var a=(n=e&&e.data("cke-realelement"))?CKEDITOR.plugins.link.tryRestoreFakeAnchor(i,e):CKEDITOR.plugins.link.getSelectedLink(i);if(a){var l=(this._.selectedElement=a).data("cke-saved-name");this.setValueOf("info","txtName",l||""),!n&&t.selectElement(a),e&&(this._.selectedElement=e)}this.getContentElement("info","txtName").focus()},contents:[{id:"info",label:i.lang.link.anchor.title,accessKey:"I",elements:[{type:"text",id:"txtName",label:i.lang.link.anchor.name,required:!0,validate:function(){return!!this.getValue()||(alert(i.lang.link.anchor.errorName),!1)}}]}]}});