:javascript
  $(document).ready(function() {
    htmlErrorToTooltip('top');
    $('.estado').change(function(){
      debeComentar(this,true);
    });    
  });
  function debeComentar(elemento,checkValidity) {
    campo = $(elemento).closest("tr").children('td.comentario').find('textarea');
    var num = $(elemento).val();
    if( num == 3 || num == 4) {
      campo.addClass('required-field');
    } else{
      campo.removeClass('required-field');
    }

    if ( checkValidity ) {
      checkFieldValidity(campo);
    }
  }
- titulo t(:auditoria_revisa_, item: "#{@auditoria.nombre.upcase}")
= simple_form_for @auditoria, url: guardar_revisar_auditorias_manifestacion_de_interes_path(@tarea_pendiente, @manifestacion_de_interes), method: :patch, remote: true do |f|
  .row
    .col-12
      .card
        .card-header
          %h5.no-margin=titulo_instrumento.html_safe
          -if @proyecto.blank?
            %h5.no-margin=titulo_acuerdo.html_safe
          -else
            %h5.no-margin=titulo_proyecto.html_safe
          %h5.no-margin=datos_beneficiario.html_safe    
          %h5
          %h5   
          %h5.no-margin
            %b=t(:elementos_a_revisar)        
        .card-body.p-0
          %table.table.table-striped.table-bordered#adhesiones_rechazadas
            %thead
              %tr
                %th=t(:rut_institucion)
                %th=t(:auditoria)
                %th=t(:auditoria_id)
                %th=t(:elemento_auditado)
                %th=t(:elemento_auditado_id)
                %th=t(:campos_acción)
                %th=t(:aplica)
                %th=t(:motivo)
                %th=t(:cumple)
                %th=t(:archivo_evidencia)
                %th=t(:archivo_informe)
                %th.direccion=t(:estado_revisión)
                %th=t(:observaciones)
            %tbody
              - if @auditoria.auditoria_elementos.blank?
                %tr
                  %td.text-center{colspan: 13} No hay elementos de auditoría
              = f.fields_for :auditoria_elementos do |ae|
                - if [2].include? (ae.object.estado) 
                  %tr
                    %td=ae.object.adhesion_elemento.persona.contribuyente.rut_completo
                    %td=ae.object.auditoria.nombre
                    %td=ae.object.auditoria.id
                    %td=ae.object.adhesion_elemento.nombre_del_elemento
                    %td=ae.object.id
                    %td=ae.object.set_metas_accion.descripcion_accion
                    %td=ae.object.aplica ? t(:yes_with_fa_check).html_safe : t(:no_with_fa_times).html_safe
                    %td=ae.object.motivo
                    %td=ae.object.cumple ? t(:yes_with_fa_check).html_safe : t(:no_with_fa_times).html_safe
                    %td.text-center
                      -
                      = link_to ae.object.archivo_evidencia.url, target: :_blank do
                        %i.fa.fa-file
                    %td.text-center
                      = link_to ae.object.archivo_informe.url, target: :_blank do
                        %i.fa.fa-file
                    %td= ae.input :estado, collection: [['Revisión', 2], ['Observaciones', 3], ['Rechazado', 4], ['Aprobado', 5]], label: false, include_blank: false, include_hidden: false, input_html: {class: 'not-required-if-other-like-me-is-present estado'}
                    %td.comentario= ae.input :observacion, label: false, input_html: {readonly: false, value: nil}
  .float-right
    = volver_root
    - unless @auditoria.auditoria_elementos.blank?
      = button_tag t(:save), 'data-disable-with' => "<i class='fa fa-spinner fa-spin'></i> Guardando...".html_safe, id: 'consultar-button', class: "btn btn-sm btn-primary button-send, btn-disabled", disabled: true